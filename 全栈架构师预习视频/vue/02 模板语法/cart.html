<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<style>
        .active{
            color: blueviolet
        }
        .message-box{
           width:200px;
           height:40px;
           line-height:40px;
           padding:5px;
           background: blueviolet;
           font-size:14px;
           text-align:center;
        }
        .close{
            float:right;
            display: inline-block;
            width:20px;
            height:20px;
            text-align:center;
            line-height:20px;
        }
        .fade-enter{
            opacity: 0;
        }
        .fade-enter-active{
            transition: opacity 1.5s
        }
        .icon{
            width:5rem;
            height:5rem;
            vertical-align: middle;
            display:inline-block;
        }
</style>
<link href="https://cdn.jsdelivr.net/npm/animate.css@3.5.1" rel="stylesheet"
type="text/css">
<body>
  <div id="app">
      <!-- 
          filter è¿‡æ»¤å™¨ä¸»è¦ç”¨æ¥è¿‡æ»¤æ–‡æœ¬
       -->
      <message :show.sync="show">
          <!-- å…·åæ’æ§½ -->
          <template v-slot:title>
            <strong>ha ha</strong>
          </template>
          <!--åŒ¿åæ’æ§½ -->
          <template v-slot:default>
                è¯¾ç¨‹æ–°å¢æˆåŠŸ
          </template>
      </message>
      <message :show.sync="showWarn">
            <!-- å…·åæ’æ§½ -->
            <template v-slot:title>
              <strong>è­¦å‘Š</strong>
            </template>
            <!--åŒ¿åæ’æ§½ -->
            <template v-slot:default>
                  è¯·è¾“å…¥å†…å®¹
            </template>
        </message>
      <headering level="3"   title="è½¦æ°´é©¬ğŸ‰" icon="heisenlindangao">äº‘æ·±ä¸çŸ¥å¤„</headering>
      <course-add @add-list="addList" v-model="text"></course-add>
      <p>
          <input type="text" v-model.number="price">
          <button @click=updatePrice>ä»·æ ¼è®¾ç½®</button>
      </p>
      <div>
          <button @click="closeMessage">æ‰¹é‡æ¸…é™¤</button>
        </div>
      <course-list :data="dataList"></course-list>
      <!-- <ul>
          <li v-for="item in dataList" :key="item">{{item}}</li>
      </ul> -->
      <div>è¯¾ç¨‹æ€»æ•°:{{count}}</div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
  <!-- æ·˜å®é‡Œä¸‹è½½çš„å›¾æ ‡åº“ -->
  <script src="https://at.alicdn.com/t/font_1819067_5pe79w0l6bt.js"></script>
  <script src="./plugin.js"></script>
  <!-- <script src="./minmin.js"></script> -->
  <!-- æ··å…¥çš„å¼•ç”¨ -->
  <script>
      // äº‹ä»¶æ€»çº¿   
      // äº‹ä»¶æ€»çº¿æ´¾å‘äº‹ä»¶
      // this.$bus.$emit('message-close')
      // äº‹ä»¶æ€»çº¿æ¥æ”¶äº‹ä»¶
      //  this.$bus.$on('message-close',() => {
      //    this.$emit('update:show', false)    
      //})
      // vm.$on()
      // vm.$emit()
      // vm.$once()
      // vm.$off()  // ä»€ä¹ˆéƒ½ä¸å†™è¡¨ç¤ºå–æ¶ˆæ‰€æœ‰äº‹ä»¶çš„ç›‘å¬
      // vm.$off(â€˜addâ€™)  // å–æ¶ˆç›‘å¬åä¸ºadd çš„äº‹ä»¶
      // vm.$off('add', callback) // å–æ¶ˆäº‹ä»¶ç›‘å¬çš„å›è°ƒ

      let role = "admin"

      Vue.prototype.$bus = new Vue();

      // è‡ªå®šä¹‰æŒ‡ä»¤

      Vue.directive('focus',{
          inserted(el){
            el.focus()
          }
      })

      Vue.directive('permission',{
          inserted(el,bindings){
              if(role === bindeings.value){
                el
              }
          }
      })

      // æ¸²æŸ“å‡½æ•°çš„ä½¿ç”¨
      // render(createElement){
      //   return createElement(
      //        tag,     æ ‡ç­¾
      //        data,    èŠ‚ç‚¹çš„å±æ€§
      //        children å­èŠ‚ç‚¹
      //    )    
      //    

      //}
    //   // æ¸²æŸ“å‡½æ•°çš„ä½¿ç”¨
    //   Vue.component('headering',{
    //       props:['level', 'title','icon'],
    //       render(h){
    //           let children = []
    //           if(this.icon){
    //               children.push(
    //                 h(
    //                   'svg',
    //                   {class: 'icon'},
    //                   [
    //                       h( 
    //                           'use',
    //                           {attrs:{'xlink:href': '#icon-'+ this.icon}}

    //                       )
    //                   ]
    //                 )
    //               )
    //             children =  children.concat(this.$slots.default)
    //           }
    //           return h(
    //               'h'+ this.level,
    //               {attrs: {title: this.title}},
    //               children
    //           )
    //       }
    //   })
      
    //   Vue.property.$bus = new Vue()
      //  åˆ—è¡¨ç»„ä»¶ ç»„ä»¶çš„å‘½åæœ€å¥½æ˜¯ç¾Šè‚‰ä¸²å‘½åæ³•ï¼Œå› ä¸ºhtmlæ ‡ç­¾ä¸åŒºåˆ†å¤§å°å†™ é©¼å³°å‘½åæ³•æ˜¯ä¸æ¨è
      // props å¯ä»¥æ˜¯ ['dataList'] çš„å½¢å¼ä¹Ÿå¯ä»¥æ˜¯ å¯¹è±¡çš„å½¢å¼ å¯¹è±¡çš„å½¢å¼æ¯”è¾ƒå¥½å¯ä»¥è¿›è¡Œæ ‡è®°
      Vue.component('course-list',{
          props:{
            data:{
                type:Array,
                default:()=>{
                    return []
                }
            }
          },
          data() {
              return {

              }
          },
          template: `
            <div>
                <ul>
                  <li v-for="item in data" :key="item.name">
                  {{item.name}}
                  {{item.price | filterPrice }}
                  </li>
                </ul>
            </div>
          `,
          filters:{
             filterPrice(value){
                 return '$' + value
             } 
          }
      })

      // åœ¨è‡ªå®šä¹‰ç»„ä»¶ä¸­æ²¡æœ‰ v-model 
      // è¿™ä¸ª v-model æ˜¯ä¸€ä¸ªè¯­æ³•ç³– ä¸»è¦æ˜¯input é‡Œçš„ @input äº‹ä»¶å’Œ ï¼švalue äº‹ä»¶
      Vue.component('course-add',{
        //  model: {
        //    prop: 'value',
        //    event: 'change'
        //   },
          props: ['text'],
          template: `
            <div>
                <input type="text"  :value="text" @input="onInput" v-focus>
                <input type="button" @click="addList" value="æ·»åŠ ">
            </div>
          `,
          methods: {
              addList(){
                  this.$emit('add-list')
              },
              onInput(e) {
                  this.$emit('input', e.target.value)

              }
          }
      })
      const myMixmin = {
        created() {
            // console.log('mixMIn created')
            this.helloWorld()
        },
        methods: {
            helloWorld() {
                console.log('hello myMinxin')
            }
        }
      }
      // messagebox å¼¹æ¡†
      Vue.component('message',{
          props:['show'],
          mixins:[myMixmin],
          template: `
           <transition
             enter-active-class="animated zoomIn"
             leave-active-class="animated zoomOut"
           >
                <div class="message-box" v-if="show">
                    <slot name="title"></slot>
                    <slot></slot>
                    <span class="close" @click="$emit('update:show', false)">X</span>
                </div>
           </transition>
  
          `,
          mounted() {
              this.$bus.$on('message-close', () => {
                this.$emit('update:show', false)
              })
          }
      })
      // æ¨¡æ‹Ÿå¼‚æ­¥æ•°æ®åŠ è½½
      function getCourse() {
        return new Promise(resolve => {
            setTimeout(function(){
               resolve([{name:'web å…¨æ ˆ' },{name: 'web é«˜çº§'} ])
            },2000)

        })
      }
      let app = new Vue({
          el: '#app',
          data() {
              return {
                  title: '123',
                  dataList: [],
                  text: '',
                  show: false,
                  showWarn: false,
                  price: '0'
              }
          },
          computed:{
              count() {
                  return this.dataList.length + 'é—¨'
              }
          },
        //   watch: {
        //       dataList: {
        //           immediate: true,  // è®¾ç½®è¿™ä¸ªé»˜è®¤é¦–æ¬¡éœ€è¦åŠ è½½ï¼Œé»˜è®¤é¦–æ¬¡è¿›æ¥æ˜¯ä¸ç”¨åŠ è½½çš„
        //           deep:true,
        //           handler(oldVal,newVal){
        //               this.count = newVal.length + 'é—¨'
        //           }
        //       }

        //   },
          beforeCreate(){console.log('beforeCreate')}, // æ‰§è¡Œç»„ä»¶å®ä¾‹è¿˜æœªåˆ›å»ºï¼Œé€šå¸¸ç”¨äºæ’ä»¶å¼€å‘ä¸­ç”¨äºåˆå§‹åŒ–ä»»åŠ¡
          created() {
              console.log('created')  //ç»„ä»¶åˆå§‹åŒ–å®Œæ¯•ï¼Œå„ç§æ•°æ®å¯ä»¥ä½¿ç”¨ï¼Œå¸¸ç”¨äºå„ç§å¼‚æ­¥æ•°æ®è·å–
          },
          beforeMount() {
              console.log('beforeMount')  // æœªæ‰§è¡Œæ¸²æŸ“ æ›´æ–°  dom æœªåˆ›å»º
          },
          mounted() {
              console.log('mounted')  //åˆå§‹åŒ–ç»“æŸï¼Œdom å·²åˆ›å»º å¯ç”¨äºè·å–è®¿é—®æ•°æ®å’Œdom å…ƒç´ 
              this.getData()
              this.updatePrice()
          },
          methods: {
              render() {
                  with(this){return _c('div',{attrs:{"id":"app"}},[_c('div',[_v(_s(title))])])}
              },
              addList() {
                  if(this.text){
                    this.dataList.push({name:this.text})
                    this.text = ''
                    this.show = true
                  }else{
                    this.showWarn = true
                  }
              },
              updatePrice() {
                  // å¦‚æœæ˜¯åœ¨åˆå§‹åŒ–æ•°æ®é‡Œä¸å­˜åœ¨çš„æ•°æ®å±æ€§ åœ¨ä½¿ç”¨çš„æ—¶å€™éœ€è¦ä½¿ç”¨
                  // éœ€è¦æ›´æ”¹çš„å¯¹è±¡  éœ€è¦æ›´æ”¹çš„å¯¹è±¡å±æ€§  éœ€è¦æ›´æ”¹çš„æœ€åçš„å€¼
                  // this.$set(c, 'price', this.price)
                  // this.$delete(c, 'price', this.price)
                  console.log(this.price)
                  this.dataList.map(c => {
                    //   c.price = this.price
                      this.$set(c, 'price',this.price)
                  })
              },
              closeMessage() {
                  this.$bus.$emit('message-close')
              },
              async getData() {
                  let res = await getCourse()
                  this.dataList = res
              }
          }
      })
      console.log(app.$options.render)
  </script>
</body>
</html>